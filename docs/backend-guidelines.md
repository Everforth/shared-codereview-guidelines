## レビュープロセス（必須手順）

### STEP 0: PR の理解

**【開始条件】レビューを開始する前に必ず実施**

1. **PR Description の精読**
   - 「なぜやるか」: 解決しようとしている課題を理解
   - 「やったこと」: 実装内容の概要を把握
   - 「確認したいこと」: レビュアーへの質問事項を確認
2. **変更の影響範囲の把握**
   - 変更されたファイル一覧を確認
   - 新規追加 vs 既存修正 を区別
   - API仕様変更やDB変更の有無を確認

**【2回目以降のレビューの場合】**

1. **前回指摘事項の確認**
   - 🔴修正必須項目が解消されているか
   - 🟡修正推奨項目への対応状況を確認
2. **新規変更箇所の特定**
   - 前回レビュー後の追加変更を特定
   - 修正対応による副次的な影響範囲を確認
3. **レビュー継続判断**
   - 全て解消済み → 未レビューの層があれば次の層へ
   - 新たな問題発見 → 該当層を再レビュー

### STEP 1: 層の特定

以下の順序でコード変更を確認し、問題が見つかった最初の1つの層を特定してください。
順序は必ず守ってください。

1. DB層（Entity定義, 型定義, スキーマ定義 等）
   - データモデルの整合性、制約・インデックスの適切性、型定義の一貫性

2. Controller層（エンドポイント、リクエスト/レスポンス処理、DTO 等）
   - エンドポイント設計、バリデーション・エラーハンドリング、HTTPステータスコード

3. Service層（ビジネスロジック、データ処理 等）
   - ビジネスロジックの正確性、トランザクション境界の適切性、データ変換処理

4. その他（テストコード, 設定ファイル 等）

【完了条件】特定した層を明記してください → 【　　　】層

### STEP 2: ガイドライン確認

【開始条件】STEP 1で層を特定済みであること

STEP 1で特定した層に対応するガイドラインを確認してください。
該当する1つのガイドラインのみ参照し、他の層のガイドラインは絶対に開かないでください。

- DB層を特定した場合のみ: @shared-codereview-guidelines/docs/backend-layers/1_db.md
- Controller層を特定した場合のみ: @shared-codereview-guidelines/docs/backend-layers/2_controller.md
- Service層を特定した場合のみ: @shared-codereview-guidelines/docs/backend-layers/3_service.md
- その他を特定した場合のみ: @shared-codereview-guidelines/docs/backend-layers/4_other.md

### STEP 3: レビュー実施

**【開始条件】**

- STEP 1で層を特定済みであること
- STEP 2で該当するガイドラインを確認済みであること

STEP 1で特定した層をレビューし、問題がない場合はSTEP 1に戻って次の層を確認してください。

**【レビュー結果の記載形式】**

レビュー結果は必ず以下の形式で出力してください:

#### 🔴 修正必須（マージブロッカー）

- バグや不具合
- セキュリティリスク
- 仕様との明確な不一致
- 既存コードとの破壊的な非互換性

#### 🟡 修正推奨（今回または次回対応）

- 保守性・拡張性の明確な改善
- パフォーマンスの測定可能な向上
- 明確な設計原則違反

### 禁止事項（重要）

1. 複数の層のレビューを出力しない
   - 最初に問題を発見した層以外のコードについて言及しないでください

   - 例: DB層で問題を発見したら、Service層やController層の問題は指摘しない

   - 例: DB層に問題がないことを確認する前にService層の問題を指摘しない

2. 総評・まとめ・良い点の言及は不要
   - 「総評」「総合評価」「まとめ」「全体として」「技術的評価」などのセクションを作成しない

   - 「〜が良いです」「〜は適切です」などのポジティブな評価を記載しない

   - レビュー結果の形式（🔴修正必須、🟡修正推奨）は問題点の整理であり、総評ではないため使用する

3. 層のレビュー完了後の処理
   - 特定した層のレビューが完了し、問題がない場合は次の層のレビューを実施する

   - 全ての層のレビューが完了するまで、順序通りに続ける

### レビュー観点

#### 基本原則

- コードの可読性と保守性を最優先
- 既存の設計パターンやベストプラクティスに従う
- 無駄を削ぎ落とし、シンプルで綺麗なコードを目指す
